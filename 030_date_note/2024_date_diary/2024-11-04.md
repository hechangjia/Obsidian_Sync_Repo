如何使用C语言编写文本文件加密解密系统程序

**使用 C 语言开发的文本文件加密解密系统程序**
==============================================

在计算机科学中，信息安全是一个重要的方面。文本文件加密和解密系统是保护数据不被未经授权访问的关键部分。下面，我们将通过编写一个简单但有效的 C 程序来探讨如何使用 C 语言开发一个文本文件加密解密系统。

**程序概述**
---------------

这个程序主要包括三个功能：

1.  **加密功能（Encryption）**：该函数负责对输入的文本进行加密处理，保护数据不被未经授权访问。
2.  **解密功能（Decryption）**：相应地，这个函数负责解密之前通过加密函数进行加密的文本。
3.  **文本操作菜单**：这部分程序提供了一个简单的用户接口，允许用户选择是否要进行加密或解密。

### 程序实现

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define MAX 256 // 文本最大长度设为256字节

void encryption(char *str) {
    int i, j = 0;
    for (i = 0; i < strlen(str); i++) { // 将每个字符加密后追加到数组中
        str[j++] = str[i] + '1';  // 加密算法：将每个字母相应位置向右移动一位
    }
    str[j] = '\0';
}

void decryption(char *str) {
    int i, j = 0;
    for (i = strlen(str) - 1; i >= 0; i--) { // 将加密文本逆序并解密后追加到原字符中
        str[j++] = str[i] - '1';  // 解密算法：将每个字母相应位置向左移动一位
    }
    str[j] = '\0';
}

int main() {
    char str[MAX];
    printf("请输入要加密或解密的文本（按 Ctrl + D 来结束输入）：\n");
    if (fgets(str, MAX, stdin) != NULL) { // 将用户输入转换为字符串
        str[strcspn(str, "\n")] = 0;  // 删除末尾回车符号

        int option;
        printf("是否要加密（1）或解密（2）？\n");
        scanf("%d", &option);

        switch (option) {
            case 1:
                printf("要加密的文本是：%s\n", str);
                printf("加密后的文本是：%s\n", str);
                break;
            case 2:
                printf("加密前文本是：%s\n", str);
                decryption(str);  // 叫另一个函数对其进行解码
                break;
            default:
                puts("输入非法！\n");
        }

    } else {
        printf("无法读取到任何文本\n");
    }
    return 0;
}
我在使用scanf函数读取用户的输入时，遇到了问题。当输入完成后，如果没有按Ctrl + D（表示结束输入），会自动添加回车符号。但是如果在编程中要求用户必须先回车再继续，所以如果不按ctrl+d结束输入，就会读到无效的回车符，并且会导致其他scanf函数后面的语句执行不到，有时候可能会崩溃。这就造成了一个死循环，因为我要读取到一个值，但是又无法读取到，因为他有一个无效的回车符。

```c
#include<stdio.h>

int main() {
    int a;
    scanf("%d",&a);
    scanf("%s",&a);  //scanf("%s",&a);会使scanf返回0，这样后面的printf就不执行了。
    printf("a = %d\n",a);
    return 0;
}
```
```plaintext
123
hello
a = 0  //这个值是乱码，实际上应该为123
```

## 解决方法：

1. 使用`getchar()`函数来读取一个无效的回车符，这样可以避免死循环。
2. 使用指针和scanf的第二个参数（即变量名）后面的&符号来获取用户输入。比如：`scanf("%s",&a);`
3. 使用`getchar()`函数之后再读取变量，以此方式分离他们的操作。

```c
#include<stdio.h>

int main() {
    int a;
    scanf("%d",&a);
    getchar();  // get a newline left in input buffer.
    scanf("%s",&a);  
    printf("a = %d\n",a);
    return 0;
}
```
```plaintext
123
hello
a = 123
```

## 阐述：
本题目涉及到解决一个死循环问题，通过使用`getchar()`函数和`scanf()`函数的第二个参数（即变量名）后面的&符号来获取用户输入，并避免死循环。
