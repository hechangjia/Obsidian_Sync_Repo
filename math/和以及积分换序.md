---
tags:
  - math
  - tool_idea
---

> [!核心想法]
> 1. 如果我们有一个求和/积分问题，比如$\sum X$而这个和/积分是难以处理的
> 2. 此时我们又发现我们可以把$X$写成一个新的求和或者积分，$X=\sum Y$或者$X =\int Y$那么此时我们得到了:
> $$\sum \sum Y \text{ or }\sum \int Y$$
> 3. 交换二者的次序，试试看交换以后的结果会不会更好。

下面是一个简单但又很经典的例子:

> [!例子1：矩阵trace的可交换性]
> $A=(a_{ij}),B=(b_{ij})$分别为两个n阶方阵那么他们的迹有关系:
> $$\text{Tr}(AB) = \text{Tr}(BA)$$

其证明如下：
$$\begin{aligned}\text{Tr}(AB) &= \sum_{i}(AB)_{ii} \\ &= \sum_i\sum_jA_{ij}B_{ji} \text{ 交换次序 }\\&=\sum_j\sum_iB_{ji}A_{ij} \\&= \sum_j (BA)_{jj} = \text{Tr}(BA)\end{aligned}$$
其中关键的一点是第一步，我们把$(AB)_{ii}$展开为了一个新的求和。

### 1. 和与和换序的例子

* [[离散分部求和法]]实际上是求和换序的一个特例。

#### 1.1 卷积法

这个方法主要是利用一些已知的Dirichlet卷积的关系来简化一个算数函数。

> [!卷积法]
> 我们把被求和对象当中的一部分展开为Dirichlet卷积的形式,然后交换求和次序，从而试图把对该数论函数的估计变成对更为熟悉且简单的数论函数的估计。

卷积法的一些基本例子：

* [[利用Dirichlet卷积法解决几个数论中求和问题]] 这三个问题都可以归类为，$\sum_{k=1}^{n} f(k)\lfloor \frac{n}{k} \rfloor$的问题，而我们又想到可以展开$\left\lfloor\frac{n}{k} \right\rfloor = \sum_{m=1}^{n}\mathbf{1}_{k|m}(m)$于是这就变成了一个双重求和的问题，交换次序以后变成了$\sum_{m=1}^{n} \sum_{k|m} f(k)$而内层的求和并不困难，因为$f$都是常见的数论函数，其Dirichlet卷积也都是简单的结果。于是整个求和过程被大大简化了。
* [[素数倒数和的估计]]的2当中证明Mertens的第一个结果的时候，我们为了得到$f(x):=\sum_{n\leq x}\log(n)$的不同于使用Euler-Maclurin求和公式的渐近结果，我们想到可以利用$\log(n)=\sum_{d|n}\Lambda(d)$去展开被求和对象，从而得到$$f(x)= x\sum_{d\leq x}\frac{\Lambda(d)}{d}+O\left(x\right)$$的新的估计。
#### 1.2 把条件函数展开为一个求和

* [[把条件函数展开为新的求和然后换序]] 此笔记中阐述了交换求和次序在数论当中的另一种用法，即估计$\sum_{a,b;\text{cond}}f(a,b)=\sum_{a,b}f(a,b)\chi_{\text{cond}}(a,b)$这样的求和。此处的问题在于求和当中有一个条件cond，因为这个条件的存在导致此求和不能被直接估计。而解决的办法就是把此条件写成一个判断函数，然后想办法把判断函数展开为一个新的求和。然后通过交换次序，简化原来的求和。
把判断函数展开为求和的方式很多，例如此笔记当中1的例子就是把条件函数展开为Dirichlet卷积。而2当中则是把条件函数在特定的拓扑群上进行傅里叶展开。

#### 1.3 Taylor展开被求和对象

[[通过重整来证明表达式的非负性]]当中有这样一个例子，$$\sum_{1\leq i,j\leq
n}\left(\log(1+a_ia_j)-\log(1-a_ia_j)\right) \geq
0$$为了证明此对象非负，我们展开了被求和的对象为级数，然后交换了次序从而得到$\sum_{k\geq 1} \frac{1+(-1)^{k-1}}{k}\sum_{1\leq i,j\leq n}(a_ia_j)^{k}$，于是便证明了非负性。这里注意到双重求和，特别是求和下标范围完全一致的双重求和，对求和对象为对称的两个元素乘积的形式(比如此处的$a_ia_j$)很敏感，因为这意味着非负。



### 2. 积分与和换序
这一类问题主要表现就是把积分转换为求和问题。也就是说$$\int X = \int \sum Y = \sum \int Y$$
注意此时我们通常需要处理是否可以交换次序的问题。通常而言我们可以使用控制收敛定理来证明交换性，Fubini-Tonelli定理也是可以尝试的办法。不过通常而言，Fubini-Tonelli定理的要求实际上更高一些，毕竟这个结果要求$\sum Y$是绝对收敛的，而控制收敛定理往往只需要可以被一个可积函数控制起来。

> [!例子2]
> $$\begin{aligned}\log(2)&=\int_{0}^{1}\frac{1}{1+x}\,dx\\&=\int_{0}^{1}\sum_{n\geq 0}(-1)^nx^n \\&= \sum_{n\geq 0}\int_{0}^{1}(-1)^nx^n\\&= \sum_{n\geq 0}\frac{(-1)^n}{1+n}\end{aligned}$$

在这个例子当中，如果我们要用Fubini-Tonelli定理去判断第二行到第三行的交换，我们就需要要求和是绝对收敛的。这样加上绝对值交换过去以后会发现是发散的，因此Tonelli定理失效。但是控制收敛定理就会简单许多，因为部分和是有界的，因此交换是显然的。

#### 2.1 具体的应用
* 这通常在处理一些积分问题当中有效果。当我们发现一个积分不好处理的时候，想着把被积分的函数展开为一个求和，然后通过交换积分与求和的次序把积分问题转换为求和问题。当然如果最后的和是更为简单的，那么自然这个尝试就是有效的。具体内容可以参考[[将积分转换为级数]]。
*  [[利用交换和与积分次序算涉及整数格点数目的一个积分]]中我们需要求$$I=\int_{\mathbb{R}}\int_{\mathbb{R}}N(x,y)e^{-x^2-y^2}\,dx\,dy$$这样一个积分。其中$N(x,y):=\#\{(a,b)\in \mathbb{Z}^2:a^2+b^2\leq x^2+y^2\}$这里面我们想到利用[[把集合问题转换为函数问题]]中的做法，我们可以把$N(x,y)$写特征函数的一个求和。从而可以交换通过交换求和与积分的次序来进行简化积分$I$。
### 3.和与积分换序
顾名思义，也就是当我们在处理求和问题的时候发现不容易处理，于是考虑把被求和的一部分考虑为某个函数的积分，然后交换积分与求和的次序，看看是否能简化问题。

* 这其中一个经典的处理方法是，当我们需要证明某个双重求和的$\sum \sum X$我们通过把被求和对象改写为一个$\int Y_1Y_2$的形式那么原来的求和便成为了$$\sum\sum\int Y_1 Y_2 = \int\sum\sum Y_1Y_2 = \int(\sum Y_1)^2\geq 0$$在[[通过重整来证明表达式的非负性]]当中例如$\sum_{1\leq i,j\leq n}\frac{a_ia_j}{i+j-1} \geq 0$这个问题，我们把被求和的其中一部分$$\frac{1}{i+j-1}=\int_{0}^{1} x^{i-1}x^{j-1}\,dx $$做了处理，从而可以做到上面的操作，从而证明非负性。再比如此笔记中的另外一个问题，$$\sum_{1\leq i,j\leq n} \min(r_i,r_j)x_ix_j \geq 0$$处理方法是展开$\min(r_i,r_j) =\int_{0}^{\infty} \mathbf{1}_{t\leq r_i}(t)\mathbf{1}_{t\leq r_j}(t)\,dt$于是也可以进行上面的操作。再比如此笔记当中的$\sum_{1\leq i,j\leq n}|x_i+x_j|-|x_i-x_j|$问题,我们通过$$|x_i+x_j|-|x_i-x_j|=\frac{2}{\pi}\int_{0}^{\infty} \sum_{1\leq i,j\leq n}\frac{\sin(x_it)\sin(x_j t)}{t}\,dt $$完成此操作。

### 4. 积分换序


